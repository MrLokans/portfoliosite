{% extends "base.html" %}

{% block content %}
    <h1>STATISTICS</h1>

    <canvas id="apartmentsByWeekDay" width="110" height="80"></canvas>
    <canvas id="apartmentsByDayHour" width="110" height="80"></canvas>
    <canvas id="rentedApartmentPriceFluctuations" width="110" height="80"></canvas>
    <canvas id="soldSquareMeterPriceFluctuations" width="110" height="80"></canvas>

{% endblock %}

{% block javascripts %}
    {{ block.super }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
    <script src="https://underscorejs.org/underscore-min.js"></script>
    <script>
        var knownApartmentTypes = {
            0: 'Комната',
            1: '1 Комната',
            2: '2 Комнаты',
            3: '3 Комнаты',
            4: '4 Комнаты',
            5: '5 Комнат',
        };

        var plotData = [{
            selector: 'apartmentsByWeekDay',
            responseField: 'by_weekday',
            color: 'rgba(125, 200, 212, 255)',
            label: 'Apartments scraped by week day'
        },
        {
            selector: 'apartmentsByDayHour',
            responseField: 'by_hour',
            color: 'rgba(125, 200, 212, 255)',
            label: 'Apartments scraped by hour'
        }];
        $.get('/api/apartments/stats/fluctuations/', resp => {
            return new Chart(document.getElementById('rentedApartmentPriceFluctuations'), {
                type: 'line',
                data: {
                    labels: _.map(resp, item => item[0]),
                    datasets: _.map(knownApartmentTypes, (value, key) => {
                        return {
                            label: value,
                            data: _.map(resp, item => item[1]['rooms'][key]),
                        }
                    })
                }
            })

        });


        $.get('/api/apartments/stats/fluctuations/square-meter-price/monthly/', resp => {
            return new Chart(document.getElementById('soldSquareMeterPriceFluctuations'), {
                type: 'line',
                data: {
                    labels: _.map(resp, item => item[0]),
                    datasets: _.map(knownApartmentTypes, (value, key) => {
                        return {
                            label: value,
                            data: _.map(resp, item => item[1]['rooms'][key]),
                        }
                    })
                }
            })

        });

    </script>
{% endblock %}
